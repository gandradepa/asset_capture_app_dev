{% extends "base.html" %}
{% block title %}Capture Asset Photos{% endblock %}

{% block content %}
  <div class="rounded-xl shadow-md w-full overflow-hidden bg-white p-6">
    <h2 class="text-xl font-bold text-center mb-4">Capture Asset Photos</h2>

    <form method="POST" action="{{ url_for('submit') }}" enctype="multipart/form-data" class="space-y-4">
      <input type="hidden" name="qr_code" value="{{ qr_code }}">
      <input type="hidden" name="building_code" value="{{ building_code }}">
      <input type="hidden" name="asset_type" value="{{ asset_type }}">

      {% if asset_type == 'Mechanical' %}
        {% set fields = [
          ('image_0','Asset Plate'),
          ('image_1','UBC Tag'),
          ('image_2','Main Asset Photo'),
          ('image_3','Technical Safety BC')
        ] %}
      {% else %}
        {% set fields = [
          ('image_0','Asset Plate'),
          ('image_1','UBC Tag'),
          ('image_2','Main Asset Photo')
        ] %}
      {% endif %}

      {% for name,label in fields %}
      <div>
        <label class="block text-sm font-medium">{{ label }}</label>
        <div class="flex items-center gap-2">
          <input type="file" name="{{ name }}" accept="image/*" capture="environment"
                 onchange="previewImage(event, 'preview_{{ loop.index }}')" class="mt-1">
          <a href="javascript:void(0)" onclick="resetFile('{{ name }}','preview_{{ loop.index }}')"
             class="text-xs text-blue-600 underline ml-2">Retake</a>
        </div>
        <img id="preview_{{ loop.index }}" class="mt-2 hidden rounded border" alt="Preview {{ loop.index }}">
      </div>
      {% endfor %}

      <div class="flex gap-2 pt-2">
        <a href="{{ url_for('start', building_code=building_code, asset_type=asset_type) }}"
           class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded text-center hover:bg-gray-300">Back</a>
        <button type="submit" class="flex-1 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
          Submit
        </button>
      </div>
    </form>
  </div>

  <script>
    function previewImage(event, previewId) {
      const img = document.getElementById(previewId);
      const file = event.target.files[0];
      if (!file) { img.classList.add('hidden'); img.src = ''; return; }
      const reader = new FileReader();
      reader.onload = e => { img.src = e.target.result; img.classList.remove('hidden'); };
      reader.readAsDataURL(file);
    }
    function resetFile(inputName, previewId) {
      const input = document.getElementsByName(inputName)[0];
      input.value = '';
      const img = document.getElementById(previewId);
      img.classList.add('hidden');
      img.src = '';
    }
  </script>
{% endblock %}
